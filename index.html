<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Football Data Tracker</title>

  <!-- Fonts + theme stylesheet -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css"/>

  <!-- Login overlay styles (updated to match the new theme) -->
  <style>
    /* === Login overlay === */
    #loginOverlay {
      position: fixed; inset: 0; z-index: 9999;
      display: none; /* shown by JS if not authenticated */
      align-items: center; justify-content: center;
      background: rgba(0,0,0,.55); backdrop-filter: blur(6px) saturate(120%);
    }
    #loginCard {
      width: min(420px, 92vw);
      background: rgba(255,255,255,.06);
      color: #fff;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px; padding: 1.25rem;
      box-shadow: 0 14px 34px rgba(0,0,0,.35);
      font-family: "Manrope", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    #loginCard h2 { margin: 0 0 .85rem 0; font-size: 1.25rem; font-weight:800; }
    #loginCard label { font-size: .9rem; opacity: .9; display:block; margin:.5rem 0 .35rem; }
    #loginCard input {
      width:100%; padding:.7rem .8rem; border-radius:12px;
      border:1px solid rgba(255,255,255,.20);
      background:rgba(255,255,255,.10); color:#fff;
    }
    #loginActions { display:flex; gap:.6rem; margin-top:.9rem; }
    #loginBtn {
      padding:.7rem 1rem; border-radius:30px; border:2px solid #3a1660; /* dark purple */
      background:#fff; color:#3a1660; cursor:pointer; flex:1; font-weight:800;
      transition: all .25s ease; letter-spacing:.2px;
    }
    #loginBtn:hover{
      background:linear-gradient(90deg, #a36bff, #c58dff); /* lighter purples on hover */
      color:#fff; border-color:transparent;
      transform: translateY(-2px);
      box-shadow:0 8px 20px rgba(163,107,255,.45);
    }
    #loginMsg { margin-top:.6rem; font-size:.9rem; min-height:1.2em; }
    #loginMsg.error { color:#ff6b6b; }
    #loginMsg.ok { color:#7CFC98; }
  </style>
</head>

<body class="theme-atl">
  <!-- Hero with centered logo + title (styled in style.css) -->
  <header class="hero">
    <div class="hero-inner">
      <img class="hero-logo" src="assets/images/owl-logo.png" alt="ATL Truth Owl Logo">
      <h1 class="hero-title">Football Data Tracker</h1>
      <p class="hero-sub">Select a data collection form</p>
    </div>
  </header>

  <main>
    <nav class="main-menu">
      <!-- White pill buttons w/ purple text; light‑purple gradient on hover -->
      <a href="game/game-day.html" class="main-menu-btn">Game Day</a>
      <a href="practice/practice.html" class="main-menu-btn">Practice</a>
      <a href="wellness/wellness.html" class="main-menu-btn">Wellness</a>
    </nav>
  </main>

  <footer class="site-footer">
    <p>&copy; 2025 Game Speed Data Systems</p>
  </footer>

  <!-- Full-page login overlay -->
  <div id="loginOverlay" aria-modal="true" role="dialog">
    <div id="loginCard">
      <h2>Sign in</h2>
      <form id="loginForm" autocomplete="off">
        <label for="loginUser">Username</label>
        <input id="loginUser" name="username" required>

        <label for="loginPass">Password</label>
        <input id="loginPass" name="password" type="password" required>

        <div id="loginActions">
          <button id="loginBtn" type="submit">Continue</button>
        </div>
        <div id="loginMsg" aria-live="polite"></div>
      </form>
    </div>
  </div>

  <!-- Auth script -->
  <script>
    // ===== Your Apps Script Web App endpoint (same one you use elsewhere) =====
    const API_BASE = 'https://script.google.com/macros/s/AKfycbwueIg8spHArqPBOhJnOxCvij8tiTC1nIWc9GY4RnaOUNNaCgaLnsJSEx3Dq1gvAd3rHw/exec';

    // ===== Auth sheet location =====
    const AUTH_SHEET_ID = '1PcHHdLAJMSV2R_5-uwax172FM7RMnMgA1p9n4VW24lk';
    const AUTH_TAB      = 'Auth_Users'; // rename if your tab is different

    // --- tiny helpers ---
    const $ = id => document.getElementById(id);
    function authIsValid(){
      const ok = localStorage.getItem('auth_ok') === '1';
      const exp = Number(localStorage.getItem('auth_until') || 0);
      return ok && Date.now() < exp;
    }
    function setAuth(landing, username){
      // 12h session window
      localStorage.setItem('auth_ok','1');
      localStorage.setItem('auth_user', username || '');
      localStorage.setItem('auth_landing', landing || 'index.html');
      localStorage.setItem('auth_until', String(Date.now() + 12*60*60*1000));
    }
    function clearAuth(){
      ['auth_ok','auth_user','auth_landing','auth_until'].forEach(k=>localStorage.removeItem(k));
    }

    async function loginRequest(username, password){
      const url = new URL(API_BASE);
      url.searchParams.set('action', 'auth_login');
      url.searchParams.set('sheet_id', AUTH_SHEET_ID);
      url.searchParams.set('sheet_name', AUTH_TAB);
      url.searchParams.set('username', username);
      url.searchParams.set('password', password);
      const r = await fetch(url.toString());
      return r.json();
    }

    // Mount login overlay on index
    (function initLoginOverlay(){
      const ov = $('loginOverlay');
      const frm = $('loginForm');
      const msg = $('loginMsg');
      const user = $('loginUser');

      async function handleSubmit(e){
        e.preventDefault();
        msg.className=''; msg.textContent='Checking…';
        try{
          const u = $('loginUser').value.trim();
          const p = $('loginPass').value.trim();
          if(!u || !p){ msg.className='error'; msg.textContent='Enter username & password.'; return; }

          const res = await loginRequest(u, p);
          if(!res.ok){ msg.className='error'; msg.textContent = res.error || 'Login failed.'; return; }

          setAuth(res.landing, u);

          // landing rules:
          // - 'index' creds: hide overlay & stay here
          // - 'wellness' creds: push to wellness page
          if (/wellness\.html$/i.test(res.landing)) {
            window.location.href = 'wellness/wellness.html';
          } else {
            ov.style.display = 'none';
            msg.className='ok'; msg.textContent='Signed in.';
          }
        } catch(err){
          msg.className='error'; msg.textContent = String(err);
        }
      }

      frm.addEventListener('submit', handleSubmit);

      // Show overlay if not authed
      if(window.location.hash === '#logout'){ clearAuth(); }
      if(!authIsValid()){
        clearAuth();
        ov.style.display = 'flex';
        setTimeout(()=>user && user.focus(), 0);
      } else {
        ov.style.display = 'none';
      }
    })();
  </script>
</body>
</html>
